<table>
  <thead>
    <tr>
      <th>Habit</th>
      {% for day in week %}
        <th>{{ day.strftime('%a') }}</th>
      {% endfor %}
    </tr>
  </thead>

  <tbody>
  {% for key, info in habits.items() %}
    {% set label = info.label %}
    <tr>
      <td>{{ label }}</td>

      {# --------------------------------------------------------------------
         One cell per day
      -------------------------------------------------------------------- #}
      {% for day in week %}
        {% set entry = data.get(day|string, {}).get(key) %}
        <td class="{{ 'cell-done' if entry else 'cell-empty' }}">

          {# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TODAY â€“ Log / Edit buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
          {% if day|string == today %}
            {% if entry is mapping %}
              <div class="entry-summary">
                âœ… {{ entry.duration }}&nbsp;min
                {% if entry.note %}
                  <div class="entry-note">ğŸ“ {{ entry.note }}</div>
                {% endif %}

                <button
                  class="edit-button"
                  data-testid="edit-{{ key }}"
                  @click.prevent="
                    showModal = true;
                    form = {
                      habit:    '{{ key }}',
                      label:    '{{ label }}',
                      duration: {{ entry.duration }},
                      note:     `{{ entry.note | e }}`,
                      date:     '{{ day|string }}'
                    };
                  "
                  title="Edit entry"
                >ğŸ–‰</button>
              </div>

            {% else %}
              <button
                class="log-button"
                data-testid="log-{{ key }}"
                @click.prevent="
                  showModal = true;
                  form = {
                    habit:    '{{ key }}',
                    label:    '{{ label }}',
                    duration: parseInt(localStorage.getItem('{{ key }}_duration')) || {{ info.default_duration }},
                    note:     localStorage.getItem('{{ key }}_note') || '',
                    date:     '{{ day|string }}'
                  };
                "
              >Log</button>
            {% endif %}

          {# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PAST / FUTURE DAYS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
          {% else %}
            {% if entry is mapping %}
              <div class="entry-summary">
                âœ… {{ entry.duration }}&nbsp;min
                {% if entry.note %}
                  <div class="entry-note">ğŸ“ {{ entry.note }}</div>
                {% endif %}
              </div>
            {% else %}
              â€“
            {% endif %}
          {% endif %}
        </td>
      {% endfor %}
    </tr>
  {% endfor %}
  </tbody>
</table>
