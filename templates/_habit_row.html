<table>
  <thead>
    <tr>
      <th>Habit</th>
      {% for day in week %}
        <th>{{ day.strftime('%a') }}</th>
      {% endfor %}
    </tr>
  </thead>

  <tbody>
    {% for key, info in habits.items() %}
      {% set label = info.label %}
      <tr>
        <td>{{ label }}</td>

        {% for day in week %}
          {% set entry = data.get(day|string, {}).get(key) %}
          <td class="{{ 'cell-done' if entry else 'cell-empty' }}">

            {# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TODAYâ€™S CELL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
            {% if day|string == today %}

              {# Already logged â€“ show inline summary + edit button #}
              {% if entry is mapping %}
                <div class="entry-summary">
                  âœ… {{ entry.duration }} min
                  {% if entry.note %}
                    <div class="entry-note">ğŸ“ {{ entry.note }}</div>
                  {% endif %}

                  <button class="edit-button"
                    @click.prevent="
                      $root.showModal = true;
                      $root.form = {
                        habit: '{{ key }}',
                        label: '{{ label }}',
                        duration: '{{ entry.duration }}',
                        note: `{{ entry.note | e }}`,
                        date: '{{ day|string }}'
                      };
                    "
                    title="Edit entry"
                  >ğŸ–‰</button>
                </div>

              {# Not logged yet â€“ show â€œLogâ€ button #}
              {% else %}
                <button class="log-button"
                  @click.prevent="
                    $root.showModal = true;
                    $root.form = {
                      habit: '{{ key }}',
                      label: '{{ label }}',
                      duration: localStorage.getItem('{{ key }}_duration') || {{ info.default_duration }},
                      note: localStorage.getItem('{{ key }}_note') || '',
                      date: '{{ day|string }}'
                    };
                  "
                >Log</button>
              {% endif %}

            {# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PAST / FUTURE DAYS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
            {% else %}
              {% if entry is mapping %}
                <div class="entry-summary">
                  âœ… {{ entry.duration }} min
                  {% if entry.note %}
                    <div class="entry-note">ğŸ“ {{ entry.note }}</div>
                  {% endif %}
                </div>
              {% else %}
                â€“
              {% endif %}
            {% endif %}

          </td>
        {% endfor %}
      </tr>
    {% endfor %}
  </tbody>
</table>
