<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>habit-track</title>
  <script src="https://unpkg.com/htmx.org@1.9.2"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs" defer></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body x-data="{ dark: false, mood: {{ mood or 3 }}, showModal: false, form: { habit: '', label: '', duration: 15, note: '' } }" :class="{ 'dark': dark }">
  <header>
    <h1>ğŸŒ¿ habit-track (Web UI)</h1>
    <div class="controls">
      <button @click="dark = !dark" class="theme-toggle">
        ğŸŒ— Toggle {{ dark ? 'Light' : 'Dark' }} Mode
      </button>
      <a href="/export" class="button">ğŸ“¥ Export as CSV</a>
      <button onclick="window.print()" class="button">ğŸ–¨ï¸ Print View</button>
    </div>
  </header>

  <section>
    <h2>ğŸ—“ï¸ Weekly Habit Grid</h2>
    <div id="habit-grid">
      {% include "_habit_row.html" %}
    </div>
  </section>

  <section class="mood-block">
    <h2>ğŸ§  Mood Score</h2>
    <form hx-post="/mood" hx-trigger="change" hx-target="this" hx-swap="none">
      <input type="range" name="score" min="1" max="5" x-model="mood">
      <output x-text="mood" style="margin-left: 0.5em;"></output>
    </form>
  </section>

  <!-- Modal -->
  <div class="modal" x-show="showModal" style="display: none;" @keydown.escape.window="showModal = false">
    <div class="modal-content" @click.outside="showModal = false">
      <h3 x-text="form.label"></h3>
      <form :action="`/log/${form.habit}`" method="post" hx-post x-on:submit="showModal = false" hx-target="#habit-grid" hx-swap="outerHTML">
        <label>Duration (minutes):</label>
        <input type="number" name="duration" x-model="form.duration" min="1" required>

        <label>Note:</label>
        <input type="text" name="note" x-model="form.note" placeholder="Optional note">

        <div class="modal-actions">
          <button type="submit">âœ… Save</button>
          <button type="button" @click="showModal = false">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</body>
</html>
